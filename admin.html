<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - BandoZen</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --navy: #0B1136; --green: #22C55F; --text: #0B1136;
            --text-light: #64748B; --border: rgba(11, 17, 54, 0.06);
            --bg: #FFFFFF; --bg-subtle: #FAFBFC;
        }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-subtle); color: var(--text); line-height: 1.6;
            -webkit-font-smoothing: antialiased; font-size: 16px;
            display: flex; min-height: 100vh;
        }
        .sidebar {
            width: 280px; background: var(--bg); border-right: 0.5px solid var(--border);
            padding: 24px; position: fixed; height: 100vh; left: 0; top: 0; z-index: 100;
        }
        .sidebar-header { margin-bottom: 40px; }
        .logo { font-size: 15px; font-weight: 600; color: var(--navy); }
        .sidebar-nav { display: flex; flex-direction: column; gap: 8px; }
        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 16px;
            border-radius: 12px; color: var(--text-light); text-decoration: none;
            font-weight: 500; font-size: 15px; transition: all 0.3s; cursor: pointer;
        }
        .nav-item:hover { background: var(--bg-subtle); color: var(--text); }
        .nav-item.active { background: var(--navy); color: white; }
        .main-content { flex: 1; margin-left: 280px; padding: 40px 48px; max-width: 1600px; }
        .admin-header { margin-bottom: 32px; display: flex; justify-content: space-between; }
        .admin-title h1 { font-size: 40px; font-weight: 600; color: var(--navy); }
        .live-badge { padding: 6px 12px; background: var(--green); color: white; border-radius: 8px; font-size: 12px; }
        .subtitle { color: var(--text-light); font-size: 17px; }
        .btn-primary {
            display: inline-flex; align-items: center; gap: 8px; padding: 12px 28px;
            background: var(--navy); color: white; border: none; border-radius: 12px;
            font-size: 15px; font-weight: 500; cursor: pointer; transition: all 0.3s;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(11, 17, 54, 0.15); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; margin-bottom: 32px; }
        .stat-card {
            padding: 28px 24px; border-radius: 16px; display: flex;
            gap: 16px; color: white; transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(11, 17, 54, 0.08);
        }
        .stat-card:hover { transform: translateY(-4px); }
        .stat-blue { background: linear-gradient(135deg, #3B82F6, #2563EB); }
        .stat-green { background: linear-gradient(135deg, #10B981, #059669); }
        .stat-orange { background: linear-gradient(135deg, #F59E0B, #D97706); }
        .stat-purple { background: linear-gradient(135deg, #8B5CF6, #7C3AED); }
        .stat-icon { width: 56px; height: 56px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; }
        .stat-label { font-size: 14px; opacity: 0.9; margin-bottom: 4px; }
        .stat-value { font-size: 36px; font-weight: 300; }
        .admin-grid { display: grid; grid-template-columns: 360px 1fr; gap: 24px; }
        .clienti-panel {
            background: var(--bg); border: 0.5px solid var(--border); border-radius: 16px;
            padding: 24px; position: sticky; top: 20px;
        }
        .panel-header h3 { font-size: 20px; font-weight: 600; color: var(--navy); margin-bottom: 4px; }
        .client-count { color: var(--text-light); font-size: 14px; margin-bottom: 20px; }
        .search-box {
            display: flex; gap: 12px; padding: 10px 14px;
            background: var(--bg-subtle); border: 0.5px solid var(--border);
            border-radius: 12px; margin-bottom: 16px;
        }
        .search-box input { flex: 1; border: none; outline: none; background: transparent; font-size: 14px; }
        .clienti-list { display: flex; flex-direction: column; gap: 12px; }
        .cliente-card {
            padding: 16px; border: 0.5px solid var(--border); border-radius: 12px;
            cursor: pointer; transition: all 0.3s; background: var(--bg);
        }
        .cliente-card.active { border-color: var(--green); background: rgba(34,197,95,0.03); }
        .cliente-card:hover { border-color: rgba(34, 197, 95, 0.3); }
        .cliente-info h4 { font-size: 17px; font-weight: 600; color: var(--navy); margin-bottom: 4px; }
        .cliente-info p { font-size: 13px; color: var(--text-light); margin-bottom: 12px; }
        .progress-bar { height: 6px; background: var(--bg-subtle); border-radius: 8px; overflow: hidden; margin-top: 8px; }
        .progress-fill { height: 100%; background: var(--green); border-radius: 8px; }
        .badge { display: inline-block; padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; margin-top: 8px; }
        .badge-blue { background: rgba(239,246,255,0.8); color: #2563EB; }
        .cliente-detail { background: var(--bg); border: 0.5px solid var(--border); border-radius: 16px; padding: 32px; }
        .detail-header { margin-bottom: 24px; }
        .detail-title h3 { font-size: 26px; font-weight: 600; color: var(--navy); }
        .tabs {
            display: flex; gap: 8px; margin-bottom: 24px;
            background: var(--bg-subtle); padding: 6px; border-radius: 12px;
        }
        .tab-button {
            flex: 1; padding: 12px 20px; background: transparent; border: none;
            border-radius: 8px; font-size: 15px; color: var(--text-light); cursor: pointer;
        }
        .tab-button.active { background: var(--navy); color: white; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        .documenti-admin-list { display: flex; flex-direction: column; gap: 16px; }
        .documento-admin-item {
            display: flex; justify-content: space-between; padding: 20px;
            background: var(--bg-subtle); border: 0.5px solid var(--border); border-radius: 12px;
        }
        .documento-admin-item.highlight { background: rgba(251,146,60,0.05); border-color: rgba(251,146,60,0.2); }
        .documento-admin-info { display: flex; gap: 16px; flex: 1; }
        .documento-icon { width: 40px; height: 40px; background: var(--bg); border: 0.5px solid var(--border); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .documento-admin-details h5 { font-size: 15px; font-weight: 600; color: var(--navy); }
        .documento-admin-details p { font-size: 13px; color: var(--text-light); }
        .documento-admin-actions { display: flex; gap: 8px; }
        .status-badge { padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; }
        .status-approved { background: rgba(209,250,229,0.8); color: #059669; }
        .status-review { background: rgba(254,243,199,0.8); color: #D97706; }
        .status-richiesto { background: rgba(254,243,242,0.8); color: #DC2626; }
        .btn-approve, .btn-reject { padding: 8px 16px; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; }
        .btn-approve { background: var(--green); color: white; }
        .btn-approve:hover { background: #16a34a; }
        .btn-reject { background: #DC2626; color: white; }
        .btn-reject:hover { background: #B91C1C; }
        .chat-messages { max-height: 400px; overflow-y: auto; margin-bottom: 20px; padding: 20px; background: var(--bg-subtle); border-radius: 12px; }
        .message { margin-bottom: 16px; }
        .message.from-admin { text-align: right; }
        .message-content { display: inline-block; padding: 14px 18px; border-radius: 12px; font-size: 15px; }
        .message.from-admin .message-content { background: #3B82F6; color: white; }
        .message.from-client .message-content { background: var(--bg); border: 0.5px solid var(--border); }
        .message-time { font-size: 12px; color: var(--text-light); margin-top: 4px; }
        .chat-input { display: flex; gap: 12px; }
        .chat-input input { flex: 1; padding: 14px 18px; border: 0.5px solid var(--border); border-radius: 12px; font-size: 15px; outline: none; }
        .btn-send { padding: 14px 24px; background: var(--green); color: white; border: none; border-radius: 12px; font-size: 15px; cursor: pointer; }
        .btn-send:hover { background: #16a34a; }
        .notification {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            background: var(--navy); color: white; padding: 16px 24px;
            border-radius: 12px; box-shadow: 0 12px 40px rgba(11, 17, 54, 0.2);
        }
        .cliente-link {
            position: fixed; bottom: 20px; right: 20px; z-index: 999;
            padding: 12px 24px; background: var(--green); color: white;
            border-radius: 12px; text-decoration: none; font-weight: 500;
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header"><div class="logo">BandoZen Admin</div></div>
        <nav class="sidebar-nav">
            <a class="nav-item active">Dashboard</a>
            <a class="nav-item">Clienti</a>
            <a class="nav-item" href="cliente.html">Vista Cliente</a>
        </nav>
    </aside>

    <main class="main-content">
        <header class="admin-header">
            <div>
                <div class="admin-title"><h1>Dashboard Admin</h1><span class="live-badge">LIVE</span></div>
                <p class="subtitle">Gestione pratiche Invitalia</p>
            </div>
            <button class="btn-primary"><span>+ Nuova Pratica</span></button>
        </header>

        <div class="stats-grid">
            <div class="stat-card stat-blue">
                <div class="stat-icon">üìÑ</div>
                <div><p class="stat-label">Totale Pratiche</p><p class="stat-value" id="statTotale">0</p></div>
            </div>
            <div class="stat-card stat-green">
                <div class="stat-icon">‚úÖ</div>
                <div><p class="stat-label">Completate</p><p class="stat-value" id="statCompletate">0</p></div>
            </div>
            <div class="stat-card stat-orange">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div><p class="stat-label">In Revisione</p><p class="stat-value" id="statRevisione">0</p></div>
            </div>
            <div class="stat-card stat-purple">
                <div class="stat-icon">‚ö†Ô∏è</div>
                <div><p class="stat-label">Documenti Pending</p><p class="stat-value" id="statPending">0</p></div>
            </div>
        </div>

        <div class="admin-grid">
            <div class="clienti-panel">
                <div class="panel-header">
                    <h3>Lista Clienti</h3>
                    <p class="client-count"><span id="clientCount">0</span> cliente/i</p>
                </div>
                <div class="search-box">
                    <input type="text" id="searchCliente" placeholder="Cerca..." oninput="searchClienti()">
                </div>
                <div class="clienti-list" id="clientiList"></div>
            </div>

            <div class="cliente-detail">
                <div class="detail-header">
                    <div class="detail-title"><h3 id="currentClientName">Seleziona cliente</h3></div>
                </div>

                <div class="tabs">
                    <button class="tab-button" onclick="switchTab('dettagli')">Dettagli</button>
                    <button class="tab-button active" onclick="switchTab('documenti')">Documenti <span id="tabDocBadge"></span></button>
                    <button class="tab-button" onclick="switchTab('chat')">Chat <span id="tabChatBadge"></span></button>
                </div>

                <div id="dettagliTab" class="tab-pane"><p>Dettagli cliente</p></div>
                <div id="documentiTab" class="tab-pane active"><div class="documenti-admin-list" id="documentiList"></div></div>
                <div id="chatTab" class="tab-pane">
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="chat-input">
                        <input type="text" id="adminMessageInput" placeholder="Scrivi..." onkeypress="if(event.key==='Enter') sendAdminMessage()">
                        <button class="btn-send" onclick="sendAdminMessage()">Invia</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <a href="cliente.html" class="cliente-link">üë§ Vista Cliente</a>

    <script>
        function getData() { const d = localStorage.getItem('bandozen_data'); return d ? JSON.parse(d) : null; }
        function saveData(data) { localStorage.setItem('bandozen_data', JSON.stringify(data)); }

        let currentClientId = 1, currentPraticaId = null;

        document.addEventListener('DOMContentLoaded', () => {
            const data = getData();
            if (!data) { alert('Apri prima Vista Cliente!'); return; }
            renderClienti(); selectCliente(1); updateStats();
        });

        function renderClienti() {
            const data = getData(); if (!data) return;
            const list = document.getElementById('clientiList');
            document.getElementById('clientCount').textContent = data.clienti.length;
            list.innerHTML = data.clienti.map(c => {
                const pratiche = data.pratiche.filter(p => p.clienteId === c.id);
                const avg = pratiche.reduce((sum, p) => sum + p.progress, 0) / pratiche.length || 0;
                return `<div class="cliente-card ${c.id === currentClientId ? 'active' : ''}" onclick="selectCliente(${c.id})">
                    <div class="cliente-info">
                        <h4>${c.nome}</h4><p>${c.email}</p>
                        <div class="progress-bar"><div class="progress-fill" style="width:${avg}%"></div></div>
                    </div>
                    <span class="badge badge-blue">${pratiche.length} pratiche</span>
                </div>`;
            }).join('');
        }

        function selectCliente(id) {
            currentClientId = id; const data = getData(); if (!data) return;
            const cliente = data.clienti.find(c => c.id === id);
            const pratiche = data.pratiche.filter(p => p.clienteId === id);
            if (pratiche.length) currentPraticaId = pratiche[0].id;
            document.getElementById('currentClientName').textContent = cliente.nome;
            renderClienti(); loadDocumenti(); loadChat(); updateTabBadges();
        }

        function loadDocumenti() {
            const data = getData(); if (!data || !currentPraticaId) return;
            const docs = data.documenti.filter(d => d.praticaId === currentPraticaId);
            const list = document.getElementById('documentiList');
            list.innerHTML = docs.map(d => `
                <div class="documento-admin-item ${d.stato === 'pending' ? 'highlight' : ''}">
                    <div class="documento-admin-info">
                        <div class="documento-icon">üìÑ</div>
                        <div class="documento-admin-details">
                            <h5>${d.nome}</h5>
                            <p>${d.tipo !== '-' ? d.tipo : 'Da caricare'}${d.size !== '-' ? ' ‚Ä¢ ' + d.size : ''}</p>
                        </div>
                    </div>
                    <div class="documento-admin-actions">
                        <span class="status-badge status-${d.stato === 'approvato' ? 'approved' : d.stato === 'pending' ? 'review' : 'richiesto'}">
                            ${d.stato === 'approvato' ? 'Approvato' : d.stato === 'pending' ? 'In Revisione' : 'Richiesto'}
                        </span>
                        ${d.stato === 'pending' ? `
                            <button class="btn-approve" onclick="approvaDocumento(${d.id})">‚úì Approva</button>
                            <button class="btn-reject" onclick="rifiutaDocumento(${d.id})">‚úï Rifiuta</button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function loadChat() {
            const data = getData(); if (!data || !currentPraticaId) return;
            const msgs = data.messaggi.filter(m => m.praticaId === currentPraticaId);
            const chat = document.getElementById('chatMessages');
            chat.innerHTML = msgs.map(m => `
                <div class="message from-${m.from === 'team' ? 'admin' : 'client'}">
                    <div class="message-content">${m.text}</div>
                    <div class="message-time">${m.time}</div>
                </div>
            `).join('');
            chat.scrollTop = chat.scrollHeight;
        }

        function updateStats() {
            const data = getData(); if (!data) return;
            document.getElementById('statTotale').textContent = data.pratiche.length;
            document.getElementById('statCompletate').textContent = data.pratiche.filter(p => p.stato === 'Completata').length;
            document.getElementById('statRevisione').textContent = data.pratiche.filter(p => p.stato.includes('Valutazione') || p.stato.includes('Approvazione')).length;
            document.getElementById('statPending').textContent = data.documenti.filter(d => d.stato === 'pending' || d.stato === 'richiesto').length;
        }

        function updateTabBadges() {
            const data = getData(); if (!data || !currentPraticaId) return;
            const pending = data.documenti.filter(d => d.praticaId === currentPraticaId && d.stato === 'pending').length;
            document.getElementById('tabDocBadge').textContent = pending ? ` (${pending})` : '';
            document.getElementById('tabChatBadge').textContent = '';
        }

        function approvaDocumento(docId) {
            const data = getData();
            const doc = data.documenti.find(d => d.id === docId);
            if (!doc) return;
            doc.stato = 'approvato';
            saveData(data);
            loadDocumenti(); updateStats(); updateTabBadges();
            showNotification(`‚úÖ "${doc.nome}" approvato!`);
            const now = new Date().toLocaleString('it-IT');
            data.messaggi.push({
                id: data.messaggi.length + 1, praticaId: currentPraticaId,
                from: 'team', text: `Documento "${doc.nome}" approvato! ‚úÖ`, time: now
            });
            saveData(data); loadChat();
        }

        function rifiutaDocumento(docId) {
            const motivo = prompt('Motivo:'); if (!motivo) return;
            const data = getData();
            const doc = data.documenti.find(d => d.id === docId);
            if (!doc) return;
            doc.stato = 'rifiutato';
            saveData(data);
            loadDocumenti(); updateStats(); updateTabBadges();
            showNotification(`‚ùå "${doc.nome}" rifiutato`);
            const now = new Date().toLocaleString('it-IT');
            data.messaggi.push({
                id: data.messaggi.length + 1, praticaId: currentPraticaId,
                from: 'team', text: `Documento "${doc.nome}" rifiutato. Motivo: ${motivo}`, time: now
            });
            saveData(data); loadChat();
        }

        function sendAdminMessage() {
            const input = document.getElementById('adminMessageInput');
            const text = input.value.trim(); if (!text) return;
            const data = getData();
            const now = new Date().toLocaleString('it-IT');
            data.messaggi.push({
                id: data.messaggi.length + 1, praticaId: currentPraticaId,
                from: 'team', text: text, time: now
            });
            saveData(data); input.value = ''; loadChat(); updateTabBadges();
            showNotification('üí¨ Messaggio inviato');
        }

        function searchClienti() {
            const q = document.getElementById('searchCliente').value.toLowerCase();
            document.querySelectorAll('.cliente-card').forEach(c => {
                c.style.display = c.textContent.toLowerCase().includes(q) ? 'block' : 'none';
            });
        }

        function switchTab(name) {
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById(name + 'Tab').classList.add('active');
        }

        function showNotification(msg) {
            const n = document.createElement('div');
            n.className = 'notification'; n.textContent = msg;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 3000);
        }
    </script>
</body>
</html>
